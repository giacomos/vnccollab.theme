<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      i18n:domain="plone">

<body>
  <div id="openerp-widget">
    Please, wait a moment...
  </div>

  <script type="text/javascript" 
          src="http://demo.vnc.biz:8085/web/webclient/js"
          tal:attributes="src string:${context/@@plone_portal_state/navigation_root_url}/++resource++vnccollab.theme.js/openerp_generic_portlet.js"></script>
  <script type="text/javascript">
    var frame = window.frameElement;
    var url = frame.getAttribute('url');
    var dbname = frame.getAttribute('dbname');
    var login = frame.getAttribute('login');
    var key = frame.getAttribute('key');
    var action_id = parseInt(frame.getAttribute('action_id'));
    var options = {"search_view": true, "display_title" : false};
    var widget = jQuery('#openerp-widget');

    if (url != '') {
      var erp = new openerp.init(["web"]);
      erp.connection.bind(url).then(function () {
        erp.connection.session_authenticate(dbname, login, key, true).then(function () {
          var client = new erp.web.EmbeddedClient(action_id, options);
          client.replace(widget);
        });
      });
    } else {
      widget.text("Couldn't connect to the server or authenticacion failed");
    }

  </script>

</body>
</html>
